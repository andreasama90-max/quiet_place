<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tich√© Miesto ‚Äì Prihl√°senie</title>
  <style>
    body {
      font-family: "Nunito Sans", sans-serif;
      background: linear-gradient(180deg, #E8F4FB, #FDFDFD);
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      transition: background 0.5s ease;
    }

    h1 {
      color: #4b8370;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    p {
      color: #666;
      font-size: 1rem;
      margin-bottom: 20px;
    }

    .login-box {
      background: #ffffff;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      padding: 30px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 10px;
      border: 1px solid #bcd5ca;
      font-size: 1rem;
    }

    button {
      background: #8bc8ae;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 25px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #77b69c;
    }

    .secondary-btn {
      background: #f7fff9;
      color: #3e6e5d;
      border: 1px solid #b9e0ca;
      border-radius: 20px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .secondary-btn:hover {
      background: #e1f4ea;
    }

    .message {
      margin-top: 15px;
      font-weight: 600;
    }

    #toggleMusic {
      background: #eaf7f3;
      color: #4b8370;
      margin-top: 15px;
      font-size: 0.9rem;
      border-radius: 8px;
      padding: 8px 15px;
    }

    /* === Modal === */
    .modal {
      display: none;
      position: fixed;
      z-index: 20;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.3);
    }

    .modal-content {
      background: white;
      margin: 10% auto;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 400px;
      text-align: left;
    }

    .modal-content h3 {
      text-align: center;
      color: #3e6e5d;
      margin-bottom: 15px;
    }

    .modal-content input {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: inherit;
    }

    .close {
      float: right;
      font-size: 1.5rem;
      cursor: pointer;
      color: #888;
    }

    .close:hover {
      color: #000;
    }
  </style>
</head>
<body>
  <h1>üå∏ Tich√© Miesto</h1>
  <p>Priestor, kde m√¥≈æe≈° by≈• s√°m sebou ‚Äì bezpeƒçne a v pokoji üåø</p>

  <div class="login-box">
    <input type="text" id="nickname" placeholder="Prez√Ωvka" maxlength="16" />
    <input type="password" id="password" placeholder="Heslo (4‚Äì16 symbolov)" maxlength="16" />
    <button id="loginBtn">Prihl√°si≈• sa</button>
    <div class="message" id="message"></div>
  </div>

  <!-- Tlaƒçidlo na otvorenie modalu -->
  <div style="text-align:center; margin-top:10px;">
    <button class="secondary-btn" id="changePasswordBtn">üîë Zmeni≈• heslo</button>
  </div>

  <!-- MODAL okno -->
  <div id="passwordModal" class="modal">
    <div class="modal-content">
      <span class="close" id="closeModal">&times;</span>
      <h3>Zmeni≈• heslo</h3>
      <label>Star√© heslo:</label>
      <input type="password" id="oldPassword" placeholder="Zadaj star√© heslo">

      <label>Nov√© heslo:</label>
      <input type="password" id="newPassword" placeholder="Zadaj nov√© heslo">

      <label>Potvrƒè nov√© heslo:</label>
      <input type="password" id="confirmPassword" placeholder="Zopakuj nov√© heslo">

      <button class="post-btn" id="savePassword">Ulo≈æi≈• nov√© heslo</button>
    </div>
  </div>

  <script>
    const loginBtn = document.getElementById("loginBtn");
    const nicknameInput = document.getElementById("nickname");
    const passwordInput = document.getElementById("password");
    const message = document.getElementById("message");
    const body = document.body;
    const music = document.getElementById("calmMusic");
    const toggleBtn = document.getElementById("toggleMusic");
    let playing = false;

    const GUARDIANS = ["Str√°≈æca", "Pomocn√≠k", "Pomocn√≠k 2", "Pomocn√≠k 3"];
    const GUARDIAN_PASSWORD = "spravedlnos≈•";

    function loadUsers() {
      try {
        return JSON.parse(localStorage.getItem("users") || "{}");
      } catch {
        return {};
      }
    }

    function saveUsers(users) {
      localStorage.setItem("users", JSON.stringify(users));
    }

    loginBtn.onclick = () => {
      const name = nicknameInput.value.trim();
      const pass = passwordInput.value;

      if (!name || !pass) {
        message.style.color = "#cf6b85";
        message.textContent = "Pros√≠m, vypl≈à v≈°etky polia üå∏";
        return;
      }
      if (pass.length < 4 || pass.length > 16) {
        message.style.color = "#cf6b85";
        message.textContent = "Heslo mus√≠ ma≈• 4 a≈æ 16 znakov üîí";
        return;
      }

      if (GUARDIANS.includes(name)) {
        if (pass !== GUARDIAN_PASSWORD) {
          message.style.color = "#cf6b85";
          message.textContent = "Nespr√°vne heslo pre Str√°≈æcu / Pomocn√≠ka üîí";
          return;
        }
        localStorage.setItem("currentUser", name);
        localStorage.setItem("nickname", name);
        message.style.color = "#4b8370";
        message.textContent = `Vitaj, ${name} ‚Äî presmerov√°vam ≈•a do spr√°vy... üå∏`;
        setTimeout(() => window.location.href = "guardian_dashboard.html", 900);
        return;
      }

      const users = loadUsers();
      if (users.hasOwnProperty(name)) {
        if (users[name] !== pass) {
          message.style.color = "#cf6b85";
          message.textContent = "Nespr√°vne heslo ‚Äî sk√∫s to znova üíó";
          return;
        }
        localStorage.setItem("currentUser", name);
        localStorage.setItem("nickname", name);
        message.style.color = "#4b8370";
        message.textContent = `Vitaj sp√§≈•, ${name} ‚Äî presmerov√°vam ≈•a... üåø`;
        setTimeout(() => window.location.href = "community.html", 700);
        return;
      }

      users[name] = pass;
      saveUsers(users);
      localStorage.setItem("currentUser", name);
      localStorage.setItem("nickname", name);
      message.style.color = "#4b8370";
      message.textContent = `Vitaj, ${name} ‚Äî √∫ƒçet vytvoren√Ω. Presmerov√°vam ≈•a do komunity üå∏`;
      setTimeout(() => window.location.href = "community.html", 900);
    };

    (function autoRedirectIfLogged() {
      const cur = localStorage.getItem("currentUser");
      if (cur) {
        if (GUARDIANS.includes(cur)) {
          setTimeout(() => window.location.href = "guardian_dashboard.html", 300);
        } else {
          setTimeout(() => window.location.href = "community.html", 300);
        }
      }
    })();

    // === MODAL ===
    const modal = document.getElementById("passwordModal");
    document.getElementById("changePasswordBtn").onclick = () => modal.style.display = "block";
    document.getElementById("closeModal").onclick = () => modal.style.display = "none";
    window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };

    document.getElementById("savePassword").onclick = () => {
      const oldPass = document.getElementById("oldPassword").value.trim();
      const newPass = document.getElementById("newPassword").value.trim();
      const confirmPass = document.getElementById("confirmPassword").value.trim();

      const currentUser = localStorage.getItem("currentUser");
      if (!currentUser) {
        alert("Najprv sa prihl√°s üåø");
        return;
      }

      const users = JSON.parse(localStorage.getItem("users") || "{}");
      if (!users[currentUser] || users[currentUser] !== oldPass) {
        alert("Star√© heslo nie je spr√°vne ‚ùå");
        return;
      }

      if (newPass.length < 4) {
        alert("Nov√© heslo mus√≠ ma≈• aspo≈à 4 znaky üîí");
        return;
      }

      if (newPass !== confirmPass) {
        alert("Hesl√° sa nezhoduj√∫ ‚ö†Ô∏è");
        return;
      }

      users[currentUser] = newPass;
      localStorage.setItem("users", JSON.stringify(users));
      alert("Heslo bolo √∫spe≈°ne zmenen√© üåø");
      modal.style.display = "none";

      document.getElementById("oldPassword").value = "";
      document.getElementById("newPassword").value = "";
      document.getElementById("confirmPassword").value = "";
    };
  </script>
</body>
</html>

