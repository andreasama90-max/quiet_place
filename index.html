<script>
/* ========= TRANSLATIONS & UI TEXTS ========= */
const translations = {
  sk: {
    title: "ðŸŒ¸ TichÃ© Miesto",
    subtitle: "Priestor, kde mÃ´Å¾eÅ¡ byÅ¥ sÃ¡m sebou â€“ bezpeÄne a v pokoji ðŸŒ¿",
    nickname: "PrezÃ½vka",
    password: "Heslo (4â€“16 symbolov)",
    loginBtn: "PrihlÃ¡siÅ¥ sa",
    changePass: "ðŸ”‘ ZmeniÅ¥ heslo",
    modalTitle: "ZmeniÅ¥ heslo",
    oldPass: "StarÃ© heslo:",
    newPass: "NovÃ© heslo:",
    confirmPass: "PotvrÄ novÃ© heslo:",
    save: "UloÅ¾iÅ¥ novÃ© heslo",
    fillFields: "ProsÃ­m, vyplÅˆ vÅ¡etky polia ðŸŒ¸",
    passLength: "Heslo musÃ­ maÅ¥ 4 aÅ¾ 16 znakov ðŸ”’",
    wrongPass: "NesprÃ¡vne heslo â€” skÃºs to znova ðŸ’—",
    welcomeNew: "Vitaj, {name} â€” ÃºÄet vytvorenÃ½. PresmerovÃ¡vam Å¥a do komunity ðŸŒ¸",
    welcomeBack: "Vitaj spÃ¤Å¥, {name} â€” presmerovÃ¡vam Å¥a... ðŸŒ¿",
    guardianWrong: "NesprÃ¡vne heslo pre StrÃ¡Å¾cu / PomocnÃ­ka ðŸ”’",
    guardianWelcome: "Vitaj, {name} â€” presmerovÃ¡vam Å¥a do sprÃ¡vy... ðŸŒ¸",
    changePassNoUser: "Najprv sa prihlÃ¡s ðŸŒ¿",
    changePassWrongOld: "StarÃ© heslo nie je sprÃ¡vne âŒ",
    changePassShort: "NovÃ© heslo musÃ­ maÅ¥ aspoÅˆ 4 znaky ðŸ”’",
    changePassMismatch: "HeslÃ¡ sa nezhodujÃº âš ï¸",
    changePassSuccess: "Heslo bolo ÃºspeÅ¡ne zmenenÃ© ðŸŒ¿"
  },
  en: {
    title: "ðŸŒ¸ Quiet Place",
    subtitle: "A space where you can be yourself â€“ safe and calm ðŸŒ¿",
    nickname: "Nickname",
    password: "Password (4â€“16 symbols)",
    loginBtn: "Log In",
    changePass: "ðŸ”‘ Change Password",
    modalTitle: "Change Password",
    oldPass: "Old Password:",
    newPass: "New Password:",
    confirmPass: "Confirm Password:",
    save: "Save New Password",
    fillFields: "Please, fill all fields ðŸŒ¸",
    passLength: "Password must be 4 to 16 characters ðŸ”’",
    wrongPass: "Wrong password â€” try again ðŸ’—",
    welcomeNew: "Welcome, {name} â€” account created. Redirecting to community ðŸŒ¸",
    welcomeBack: "Welcome back, {name} â€” redirecting... ðŸŒ¿",
    guardianWrong: "Wrong guardian/helper password ðŸ”’",
    guardianWelcome: "Welcome, {name} â€” redirecting to dashboard... ðŸŒ¸",
    changePassNoUser: "Please log in first ðŸŒ¿",
    changePassWrongOld: "Old password is incorrect âŒ",
    changePassShort: "New password must be at least 4 characters ðŸ”’",
    changePassMismatch: "Passwords do not match âš ï¸",
    changePassSuccess: "Password changed successfully ðŸŒ¿"
  },
  cz: {
    title: "ðŸŒ¸ TichÃ© MÃ­sto",
    subtitle: "Prostor, kde mÅ¯Å¾eÅ¡ bÃ½t sÃ¡m sebou â€“ v bezpeÄÃ­ a klidu ðŸŒ¿",
    nickname: "PÅ™ezdÃ­vka",
    password: "Heslo (4â€“16 symbolÅ¯)",
    loginBtn: "PÅ™ihlÃ¡sit se",
    changePass: "ðŸ”‘ ZmÄ›nit heslo",
    modalTitle: "ZmÄ›nit heslo",
    oldPass: "StarÃ© heslo:",
    newPass: "NovÃ© heslo:",
    confirmPass: "PotvrÄ novÃ© heslo:",
    save: "UloÅ¾it novÃ© heslo",
    fillFields: "ProsÃ­m, vyplÅˆ vÅ¡echny pole ðŸŒ¸",
    passLength: "Heslo musÃ­ mÃ­t 4 aÅ¾ 16 znakÅ¯ ðŸ”’",
    wrongPass: "NesprÃ¡vnÃ© heslo â€” zkus to znovu ðŸ’—",
    welcomeNew: "VÃ­tej, {name} â€” ÃºÄet vytvoÅ™en. PÅ™esmÄ›rovÃ¡vÃ¡m do komunity ðŸŒ¸",
    welcomeBack: "VÃ­tej zpÄ›t, {name} â€” pÅ™esmÄ›rovÃ¡vÃ¡m... ðŸŒ¿",
    guardianWrong: "NesprÃ¡vnÃ© heslo pro StrÃ¡Å¾ce / PomocnÃ­ka ðŸ”’",
    guardianWelcome: "VÃ­tej, {name} â€” pÅ™esmÄ›rovÃ¡vÃ¡m do sprÃ¡vy... ðŸŒ¸",
    changePassNoUser: "Nejprve se prosÃ­m pÅ™ihlas ðŸŒ¿",
    changePassWrongOld: "StarÃ© heslo nenÃ­ sprÃ¡vnÃ© âŒ",
    changePassShort: "NovÃ© heslo musÃ­ mÃ­t alespoÅˆ 4 znaky ðŸ”’",
    changePassMismatch: "Hesla se neshodujÃ­ âš ï¸",
    changePassSuccess: "Heslo bylo ÃºspÄ›Å¡nÄ› zmÄ›nÄ›no ðŸŒ¿"
  }
};

/* ========= UI ELEMENTS ========= */
const switchButtons = document.querySelectorAll(".language-switch button");
const titleEl = document.getElementById("title");
const subtitleEl = document.getElementById("subtitle");
const nicknameInput = document.getElementById("nickname");
const passwordInput = document.getElementById("password");
const loginBtn = document.getElementById("loginBtn");
const changePasswordBtn = document.getElementById("changePasswordBtn");
const messageEl = document.getElementById("message");

/* ========= GUARDIANS ========= */
const GUARDIANS = ["StrÃ¡Å¾ca", "PomocnÃ­k", "PomocnÃ­k 2", "PomocnÃ­k 3"];
const GUARDIAN_PASSWORD = "spravedlnosÅ¥";

/* ========= Helpers for users storage ========= */
function loadUsers() {
  try { return JSON.parse(localStorage.getItem("users") || "{}"); }
  catch { return {}; }
}
function saveUsers(obj) { localStorage.setItem("users", JSON.stringify(obj)); }

/* ========= LANGUAGE ========== */
function applyTranslations(lang) {
  const t = translations[lang];
  titleEl.textContent = t.title;
  subtitleEl.textContent = t.subtitle;
  nicknameInput.placeholder = t.nickname;
  passwordInput.placeholder = t.password;
  loginBtn.textContent = t.loginBtn;
  changePasswordBtn.textContent = t.changePass;
  document.getElementById("modalTitle").textContent = t.modalTitle;
  document.getElementById("oldPassLabel").textContent = t.oldPass;
  document.getElementById("newPassLabel").textContent = t.newPass;
  document.getElementById("confirmPassLabel").textContent = t.confirmPass;
  document.getElementById("savePassword").textContent = t.save;

  // active class on buttons
  switchButtons.forEach(b => b.classList.remove("active"));
  const btn = document.querySelector(`[data-lang="${lang}"]`);
  if (btn) btn.classList.add("active");
  localStorage.setItem("lang", lang);
}
switchButtons.forEach(btn => btn.addEventListener("click", () => applyTranslations(btn.dataset.lang)));
const savedLang = localStorage.getItem("lang") || "sk";
applyTranslations(savedLang);

/* ========= LOGIN / REGISTER LOGIC ========= */
loginBtn.addEventListener("click", () => {
  const name = nicknameInput.value.trim();
  const pass = passwordInput.value;

  const t = translations[localStorage.getItem("lang") || savedLang];

  if (!name || !pass) {
    messageEl.style.color = "#cf6b85";
    messageEl.textContent = t.fillFields;
    return;
  }
  if (pass.length < 4 || pass.length > 16) {
    messageEl.style.color = "#cf6b85";
    messageEl.textContent = t.passLength;
    return;
  }

  // guardians
  if (GUARDIANS.includes(name)) {
    if (pass !== GUARDIAN_PASSWORD) {
      messageEl.style.color = "#cf6b85";
      messageEl.textContent = t.guardianWrong;
      return;
    }
    localStorage.setItem("currentUser", name);
    localStorage.setItem("nickname", name);
    messageEl.style.color = "#4b8370";
    messageEl.textContent = t.guardianWelcome.replace("{name}", name);
    setTimeout(() => window.location.href = "guardian_dashboard.html", 900);
    return;
  }

  // normal users
  const users = loadUsers();
  if (users.hasOwnProperty(name)) {
    if (users[name] !== pass) {
      messageEl.style.color = "#cf6b85";
      messageEl.textContent = t.wrongPass;
      return;
    }
    localStorage.setItem("currentUser", name);
    localStorage.setItem("nickname", name);
    messageEl.style.color = "#4b8370";
    messageEl.textContent = t.welcomeBack.replace("{name}", name);
    setTimeout(() => window.location.href = "community.html", 700);
    return;
  }

  // register new
  users[name] = pass;
  saveUsers(users);
  localStorage.setItem("currentUser", name);
  localStorage.setItem("nickname", name);
  messageEl.style.color = "#4b8370";
  messageEl.textContent = t.welcomeNew.replace("{name}", name);
  setTimeout(() => window.location.href = "community.html", 900);
});

/* ========= AUTO-REDIRECT IF ALREADY LOGGED ========= */
(function autoRedirectIfLogged(){
  const cur = localStorage.getItem("currentUser");
  if (!cur) return;
  if (GUARDIANS.includes(cur)) setTimeout(()=>window.location.href="guardian_dashboard.html", 300);
  else setTimeout(()=>window.location.href="community.html", 300);
})();

/* ========= PASSWORD MODAL (open/close/save) ========= */
const modal = document.getElementById("passwordModal");
const closeModal = document.getElementById("closeModal");
const savePasswordBtn = document.getElementById("savePassword");

changePasswordBtn.addEventListener("click", () => {
  modal.style.display = "block";
});
closeModal.addEventListener("click", () => modal.style.display = "none");
window.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

savePasswordBtn.addEventListener("click", () => {
  const oldPass = document.getElementById("oldPassword").value.trim();
  const newPass = document.getElementById("newPassword").value.trim();
  const confirmPass = document.getElementById("confirmPassword").value.trim();
  const cur = localStorage.getItem("currentUser");
  const t = translations[localStorage.getItem("lang") || savedLang];

  if (!cur) { alert(t.changePassNoUser); return; }

  const users = loadUsers();
  if (!users[cur] || users[cur] !== oldPass) { alert(t.changePassWrongOld); return; }
  if (newPass.length < 4) { alert(t.changePassShort); return; }
  if (newPass !== confirmPass) { alert(t.changePassMismatch); return; }

  users[cur] = newPass;
  saveUsers(users);
  alert(t.changePassSuccess);
  modal.style.display = "none";
  document.getElementById("oldPassword").value = "";
  document.getElementById("newPassword").value = "";
  document.getElementById("confirmPassword").value = "";
});

/* ========= Optional: press Enter to login ========= */
[nicknameInput, passwordInput].forEach(el => {
  el.addEventListener("keydown", (e) => {
    if (e.key === "Enter") loginBtn.click();
  });
});
</script>




